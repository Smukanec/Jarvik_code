# Jarvikâ€‘AI: "BlbÅ¯zdornÃ½" nÃ¡vod & databÃ¡ze chyb

## 0.â€¯StruÄnÃ½ scÃ©nÃ¡Å™

1.Â Notebook (UbuntuÂ 24.04) sÂ Jarvikem bÄ›Å¾Ã­ naÂ `localhost:8000`.
2.Â Caddy reverseâ€‘proxy poslouchÃ¡ naÂ 80/443 aÂ pÅ™epojuje naÂ Jarvik.
3.Â VeÅ™ejnÃ¡ **pouze**Â IPv6 `2a00:1028:c000:16fe:a782:9e10:5d65:3569` (Å¾Ã¡dnÃ¡ IPv4).
4.Â DomÃ©naÂ `jarvik-ai.tech` (registr Webglobe)Â â†’ pozdÄ›ji delegovanÃ¡ naÂ Cloudflare.
5.Â DomÃ¡cÃ­ router **O2â€¯SmartBox** dÄ›lÃ¡ IPv6Â firewall.

---

## 1.â€¯Router O2Â SmartBox

```text
NastavenÃ­Â â†’ FirewallÂ â†’ IPv6 pravidla
  NÃ¡zev       : JarvikÂ HTTPS
  Protokol    : TCP
  CÃ­lÂ port    : 80,443
  ZdrojÂ IP    : ::/0 (vÅ¡ichni)
  CÃ­lÂ IP      : tvÃ¡â€¯IPv6 / neboÂ ::/0
UloÅ¾itÂ â†’ Restart routeru
```

**ÄŒastÃ© chyby**

* Pravidlo pÅ™idÃ¡Å¡, ale nezrestartujeÅ¡ â€•> port stÃ¡le zavÅ™enÃ½.
* Pravidlo vytvoÅ™Ã­Å¡ pro IPv4 mÃ­sto IPv6.

---

## 2.â€¯Caddyfile ( `/etc/caddy/Caddyfile` )

```caddy
# staging ACME, aÅ¥ se nevyÄerpÃ¡ rateâ€‘limit
# acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
# acme_dns ...               # (volitelnÃ© dnsâ€‘01)
jarvik-ai.tech {
    reverse_proxy 127.0.0.1:8000
}
```

```bash
sudo systemctl reload caddy
journalctl -u caddy -f | grep -Ei "acme|obtain|certificate"
```

**ÄŒastÃ© chyby**

* PonechanÃ½ eâ€‘mail `you@example.com` â†’ ACME 400Â â€invalidContactâ€œ.
* ZapomeneÅ¡ odstranit `acme_ca` poÂ ÃºspÄ›Å¡nÃ©m staginguÂ â‡’ jedeÅ¡ poÅ™Ã¡d naÂ testâ€‘certifikÃ¡t.

---

## 3.â€¯DNS naÂ Webglobe (doÂ aktivace NSÂ â†’ Cloudflare)

### 3.1Â RychlÃ© IPv6â€‘only

1.Â *DomÃ©ny â†’ DNSÂ zÃ¡znamy â†’ NovÃ½*Â â†’

```
JmÃ©no  : @
Typ    : AAAA
Hodnota: 2a00:1028:c000:16fe:a782:9e10:5d65:3569
TTL    : 300
```

2.Â Zvedni **SOAÂ serial** pÅ™i ruÄnÃ­ editaci zÃ³ny.
3.Â (VolitelnÄ›) pÅ™idej `www`Â CNAMEÂ â†’Â `@`.

### 3.2Â ÃšplnÃ¡ delegace naÂ Cloudflare

1.Â DokonÄi platbuÂ + eâ€‘mail **Verify** â†’ WHOIS musÃ­ ukÃ¡zat `Status: ok`.
2.Â *DomÃ©ny â†’ DNSÂ servery â†’ TypÂ DNSÂ **VlastnÃ­***
3.Â Vyber DNSÂ skupinuÂ `Jarvik`:

```
ada.ns.cloudflare.com
nick.ns.cloudflare.com
```

4.Â ZaÅ¡krtni autorizaciÂ â†’ eâ€‘mail potvrzenÃ­Â â†’ klikÂ **SouhlasÃ­m**.
5.Â Cloudflare dashboard pÅ™epne zÂ *Pending* naÂ **Active** \~10Â min.

**ÄŒastÃ© chyby**

* DomÃ©na ve stavu `pendingCreate`Â â†’ Webglobe neukÃ¡Å¾e tlaÄÃ­tko â€UloÅ¾itâ€œ.
* SOAÂ serial nezvednutÃ½Â â†’ zmÄ›na zÃ³ny se neprojevÃ­.

---

## 4.â€¯TestovacÃ­ pÅ™Ã­kazy

```bash
# DNS
whois jarvik-ai.tech | grep -Ei "Status|Created"
dig +short jarvik-ai.tech AAAA

dig @ns1.webglobe.cz jarvik-ai.tech AAAA +short   # pÅ™Ã­mo autoritativnÃ­

dig NS jarvik-ai.tech +short   # poÂ Cloudflare â†’ ada./nick.

# HTTP
curl -6 -I https://jarvik-ai.tech           # 200Â neboÂ 308
curl -6 -I https://www.jarvik-ai.tech
curl -4 -I https://jarvik-ai.tech           # 200Â poÂ CF, timeout pÅ™edtÃ­m
```

---

## 5.â€¯LokÃ¡lnÃ­ DNSÂ &Â cache (UbuntuÂ 24.04Â Wiâ€‘Fi)

```bash
# aktivnÃ­ profil zjistÃ­Å¡
nmcli connection show

# nastavit veÅ™ejnÃ© IPv6Â DNS
sudo nmcli connection modify "Internet" \
     ipv6.dns "2606:4700:4700::1111,2001:4860:4860::8888" \
     ipv6.ignore-auto-dns yes \
     ipv4.ignore-auto-dns yes
sudo nmcli connection up "Internet"

# flush cache
sudo resolvectl flush-caches
```

**ÄŒastÃ© chyby**

* `communications error to 8.8.8.8#53` â†’ router blokuje IPv4Â DNSÂ â†’ pouÅ¾Ã­vej IPv6Â resolver.
* PÅ™Ã­kaz `systemd-resolve --flush-caches` neexistujeÂ â†’ naÂ 24.04 je `resolvectl`.

---

## 6.â€¯Checklist (pro budoucÃ­ migrace)

* [ ] PortyÂ 80/443 otevÅ™enÃ© aÅ¾ doÂ notebooku (UFW + router IPv6 rule).
* [ ] Caddy poslouchÃ¡ `*:443` ( `lsof -i -P -n | grep 443` ).
* [ ] ACME stagingÂ â†’ prodÂ (Letâ€™s Encrypt rateâ€‘limit!).
* [ ] AAAA nebo NSÂ â†’ sprÃ¡vnÄ› propagovanÃ© (dig 1.1.1.1).
* [ ] SOA serial vÅ¾dy +1.
* [ ] `www`Â alias existuje.
* [ ] LokÃ¡lnÃ­ DNSÂ cache vyprÃ¡zdnÄ›nÃ¡ pÅ™i testovÃ¡nÃ­.

---

### ğŸ› ï¸ ReprodukovanÃ© chyby &Â jejich fix

| # | Symptom                                   | Root Cause                         | Fix                                    |
| - | ----------------------------------------- | ---------------------------------- | -------------------------------------- |
| 1 | `curl -6 ...`: *Could not resolve host*   | ZÃ³na uloÅ¾enÃ¡, ale SOA serial starÃ½ | Zvednout serial, uloÅ¾it, poÄkat TTL    |
| 2 | `timeout` pÅ™i ACME                        | IPv6 portÂ 443 blokuje SmartBox     | PÅ™idat IPv6 rule, restart routeru      |
| 3 | ACME 400Â `invalidContact you@example.com` | VÃ½chozÃ­ eâ€‘mail vÂ Caddyfile         | Nastavit platnÃ½ eâ€‘mail vÂ globalÂ { }    |
| 4 | Web funguje poÂ IPv6, ale ne poÂ IPv4       | Nameservery jeÅ¡tÄ› Webglobe         | Delegovat naÂ Cloudflare (orangeÂ cloud) |
| 5 | `communications error to 8.8.8.8#53`      | O2 blokuje externÃ­ DNSÂ UDPÂ 53      | PouÅ¾Ã­t IPv6Â resolver nebo DoH          |

---

## 7.â€¯Odkazy

* Caddy docs: [https://caddyserver.com/docs/](https://caddyserver.com/docs/)
* Letâ€™sÂ Encrypt staging: [https://letsencrypt.org/docs/staging-environment/](https://letsencrypt.org/docs/staging-environment/)
* Cloudflare DNSÂ resolver IPv6: `2606:4700:4700::1111`
* Google Public DNSÂ IPv6: `2001:4860:4860::8888`

*(AktualizovÃ¡no: 17â€¯Junâ€¯2025)*
